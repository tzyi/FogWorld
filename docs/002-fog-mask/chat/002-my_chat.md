# 002-my_chat

實作紀錄使用者位置軌跡

## specify
- ref_specify.md
```
1. 迷霧遮罩渲染
- 地圖上方需以 Canvas 技術（建議使用 Skia Canvas）繪製半透明深灰色（如 #222，60%透明度）迷霧遮罩，覆蓋整個地圖區域。
- 僅以使用者位置藍點為中心，開啟一個指定半徑（如 120px）的圓形透明區域，該區域隨使用者移動即時更新。
- 迷霧遮罩僅在使用者按下「開始探索」按鈕後開始渲染，按鈕狀態需能切換迷霧層顯示與否。

2.探索區域管理與資料存儲
- 全球地圖劃分為網格（Grid），每個座標點對應一個網格狀態（explored/unexplored）。
- 使用者行經的座標點會「擦除」對應網格的遮罩，已探索區域持續擴大透明範圍。
- 每 5-10 秒自動存儲使用者座標與軌跡（Track），並將探索狀態寫入資料庫（參考 data-model.md）。
- 地圖縮放時僅加載可視範圍內的迷霧遮罩，提升效能。
- 資料存取與查詢需利用 SQLite 索引功能優化經緯度查詢速度，相關邏輯實作於 src/services/db.ts 與 src/utils/geoUtils.ts。

3. 統計資訊與等級系統
- 系統需計算已探索面積百分比與領土等級，統計邏輯為遍歷資料庫中所有 Unique Grids。
- 統計資訊（如 total_explored, today_distance）需即時更新並顯示於狀態欄。

4. 異常與例外處理
- 若定位失敗或未授權，迷霧遮罩需全覆蓋地圖，藍點不顯示，並彈出提示訊息要求用戶授權定位。
- 地圖資料載入失敗時，顯示錯誤提示並禁止探索功能。

5. 技術細節與關鍵點
- 經緯度需正確轉換為 Canvas 座標系，確保遮罩與透明區域精確對應地圖位置。
-Canvas 遮罩渲染需考慮跨平台相容性與效能，避免卡頓或顯示異常。
```
- 執行
```
/speckit.specify 請參考 ref_specify.md
```



## Clarify

```
clarify
```





